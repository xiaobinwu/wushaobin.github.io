<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="24k-小清新个人技术博客"><meta name="keywords" content="Hexo, GulpJs, Nodejs, Reactjs, Vuejs, Javascript, 前端"><title>简单vue项目脚手架 - 前端穷屌丝，爱码人士</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/xiaobinwu"><span>Github</span></a></li><li><a href="http://www.cnblogs.com/wuxiaobin/"><span>博客园</span></a></li><li><a href="/atom.xml"><span>RSS</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="http://callfiles.ueibo.com/hexo-theme-laughing/post_background.jpg"><div class="post-title"><h1 class="title">简单vue项目脚手架</h1><ul class="meta"><li><i class="icon icon-author"></i>24k-小清新</li><li><i class="icon icon-clock"></i>45 Minutes</li><li><i class="icon icon-calendar"></i>2017年6月8日</li></ul></div></div><div class="article-content" style="max-width:800px"><h2 id="github地址"><a href="#github地址" class="headerlink" title="github地址"></a><a href="https://github.com/xiaobinwu/my-vue-scaffold" target="_blank" rel="external">github地址</a></h2><h2 id="使用技术栈"><a href="#使用技术栈" class="headerlink" title="使用技术栈"></a>使用技术栈</h2><blockquote>
<ul>
<li>webpack(^2.6.1)</li>
<li>webpack-dev-server(^2.4.5)</li>
<li>vue(^2.3.3)</li>
<li>vuex(^2.3.1)</li>
<li>vue-router(^2.5.3)</li>
<li>vue-loader(^12.2.1)</li>
<li>eslint(^3.19.0)</li>
</ul>
</blockquote>
<h2 id="需要学习的知识"><a href="#需要学习的知识" class="headerlink" title="需要学习的知识"></a>需要学习的知识</h2><p><a href="https://cn.vuejs.org/" target="_blank" rel="external">vue.js</a><br><a href="https://vuex.vuejs.org/zh-cn/" target="_blank" rel="external">vuex</a><br><a href="https://router.vuejs.org/zh-cn/" target="_blank" rel="external">vue-router</a><br><a href="https://vue-loader.vuejs.org/zh-cn/" target="_blank" rel="external">vue-loader</a><br><a href="https://doc.webpack-china.org/" target="_blank" rel="external">webpack2</a><br><a href="http://eslint.cn/docs/user-guide/configuring" target="_blank" rel="external">eslint</a><br>内容相当多，尤其是webpack2教程，官方脚手架<a href="https://github.com/vuejs/vue-cli" target="_blank" rel="external">vue-cli</a>虽然相当完整齐全，但是修改起来还是挺花时间，于是自己参照网上的资料和之前做过的<a href="https://github.com/xiaobinwu/Wuji" target="_blank" rel="external">项目</a>用到的构建工具地去写了一个简单vue项目脚手架。适用于多页面spa模式的业务场景（每个模块都是一个spa）。比较简单,主要就是一个webpack.config.js文件，没有说特意地去划分成分webpack.dev.config.js、webpack.prov.config.js等等。下面是整个webpack.config.js文件代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</div><div class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</div><div class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>)</div><div class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">'glob'</span>)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">options = &#123;&#125;</span>) =&gt;</span> &#123;</div><div class="line">    <span class="comment">// 配置文件，根据 run script不同的config参数来调用不同config</span></div><div class="line">    <span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./config/'</span> + (process.env.npm_config_config || options.config || <span class="string">'dev'</span>))</div><div class="line">    <span class="comment">// 遍历入口文件，这里入口文件与模板文件名字保持一致，保证能同时合成HtmlWebpackPlugin数组和入口文件数组</span></div><div class="line">    <span class="keyword">const</span> entries = glob.sync(<span class="string">'./src/modules/*.js'</span>)</div><div class="line">    <span class="keyword">const</span> entryJsList = &#123;&#125;</div><div class="line">    <span class="keyword">const</span> entryHtmlList = []</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> path <span class="keyword">of</span> entries) &#123;</div><div class="line">        <span class="keyword">const</span> chunkName = path.slice(<span class="string">'./src/modules/'</span>.length, -<span class="string">'.js'</span>.length)</div><div class="line">        entryJsList[chunkName] = path</div><div class="line">        entryHtmlList.push(<span class="keyword">new</span> HtmlWebpackPlugin(&#123;</div><div class="line">            <span class="attr">template</span>: path.replace(<span class="string">'.js'</span>, <span class="string">'.html'</span>),</div><div class="line">            <span class="attr">filename</span>: <span class="string">'modules/'</span> + chunkName + <span class="string">'.html'</span>,</div><div class="line">            <span class="attr">chunks</span>: [<span class="string">'manifest'</span>, <span class="string">'vendor'</span>, chunkName]</div><div class="line">        &#125;))</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 处理开发环境和生产环境ExtractTextPlugin的使用情况</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">cssLoaders</span>(<span class="params">loader, opt</span>) </span>&#123;</div><div class="line">        <span class="keyword">const</span> loaders = loader.split(<span class="string">'!'</span>)</div><div class="line">        <span class="keyword">const</span> opts = opt || &#123;&#125;</div><div class="line">        <span class="keyword">if</span> (options.dev) &#123;</div><div class="line">            <span class="keyword">if</span> (opts.extract) &#123;</div><div class="line">                <span class="keyword">return</span> loader</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">return</span> loaders</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">const</span> fallbackLoader = loaders.shift()</div><div class="line">            <span class="keyword">return</span> ExtractTextPlugin.extract(&#123;</div><div class="line">                <span class="attr">use</span>: loaders,</div><div class="line">                <span class="attr">fallback</span>: fallbackLoader</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> webpackObj = &#123;</div><div class="line">        <span class="attr">entry</span>: <span class="built_in">Object</span>.assign(&#123;</div><div class="line">            <span class="attr">vendor</span>: [<span class="string">'vue'</span>, <span class="string">'vuex'</span>, <span class="string">'vue-router'</span>]</div><div class="line">        &#125;, entryJsList),</div><div class="line">        <span class="comment">// 文件内容生成哈希值chunkhash，使用hash会更新所有文件</span></div><div class="line">        output: &#123;</div><div class="line">            <span class="attr">path</span>: resolve(__dirname, <span class="string">'dist'</span>),</div><div class="line">            <span class="attr">filename</span>: options.dev ? <span class="string">'static/js/[name].js'</span> : <span class="string">'static/js/[name].[chunkhash].js'</span>,</div><div class="line">            <span class="attr">chunkFilename</span>: <span class="string">'static/js/[id].[chunkhash].js'</span>,</div><div class="line">            <span class="attr">publicPath</span>: config.publicPath</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        <span class="attr">externals</span>: &#123;</div><div class="line"></div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        <span class="attr">module</span>: &#123;</div><div class="line">            <span class="attr">rules</span>: [</div><div class="line">                <span class="comment">// 只 lint 本地 *.vue 文件，需要安装eslint-plugin-html，并配置eslintConfig（package.json）</span></div><div class="line">                &#123;</div><div class="line">                    <span class="attr">enforce</span>: <span class="string">'pre'</span>,</div><div class="line">                    <span class="attr">test</span>: <span class="regexp">/.vue$/</span>,</div><div class="line">                    <span class="attr">loader</span>: <span class="string">'eslint-loader'</span>,</div><div class="line">                    <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span></div><div class="line">                &#125;,</div><div class="line">                <span class="comment">/*</span></div><div class="line">                    http://blog.guowenfh.com/2016/08/07/ESLint-Rules/</div><div class="line">                    http://eslint.cn/docs/user-guide/configuring</div><div class="line">                    [eslint资料]</div><div class="line">                 */</div><div class="line">                &#123;</div><div class="line">                    <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</div><div class="line">                    <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</div><div class="line">                    <span class="attr">use</span>: [<span class="string">'babel-loader'</span>, <span class="string">'eslint-loader'</span>]</div><div class="line">                &#125;,</div><div class="line">                <span class="comment">// 需要安装vue-template-compiler，不然编译报错</span></div><div class="line">                &#123;</div><div class="line">                    <span class="attr">test</span>: <span class="regexp">/\.vue$/</span>,</div><div class="line">                    <span class="attr">loader</span>: <span class="string">'vue-loader'</span>,</div><div class="line">                    <span class="attr">options</span>: &#123;</div><div class="line">                        <span class="attr">loaders</span>: &#123;</div><div class="line">                            <span class="attr">sass</span>: cssLoaders(<span class="string">'vue-style-loader!css-loader!sass-loader'</span>, &#123; <span class="attr">extract</span>: <span class="literal">true</span> &#125;)</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;,</div><div class="line">                &#123;</div><div class="line">                    <span class="comment">// 需要有相应的css-loader，因为第三方库可能会有文件</span></div><div class="line">                    <span class="comment">// （如：element-ui） css在node_moudle</span></div><div class="line">                    <span class="comment">// 生产环境才需要code抽离，不然的话，会使热重载失效</span></div><div class="line">                    test: <span class="regexp">/\.css$/</span>,</div><div class="line">                    <span class="attr">use</span>: cssLoaders(<span class="string">'style-loader!css-loader'</span>)</div><div class="line">                &#125;,</div><div class="line">                &#123;</div><div class="line">                    <span class="attr">test</span>: <span class="regexp">/\.(scss|sass)$/</span>,</div><div class="line">                    <span class="attr">use</span>: cssLoaders(<span class="string">'style-loader!css-loader!sass-loader'</span>)</div><div class="line">                &#125;,</div><div class="line">                &#123;</div><div class="line">                    <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|jpeg|gif|eot|ttf|woff|woff2|svg|svgz)(\?.+)?$/</span>,</div><div class="line">                    <span class="attr">use</span>: [</div><div class="line">                        &#123;</div><div class="line">                            <span class="attr">loader</span>: <span class="string">'url-loader'</span>,</div><div class="line">                            <span class="attr">options</span>: &#123;</div><div class="line">                                <span class="attr">limit</span>: <span class="number">10000</span>,</div><div class="line">                                <span class="attr">name</span>: <span class="string">'static/imgs/[name].[ext]?[hash]'</span></div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    ]</div><div class="line">                &#125;</div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        <span class="attr">plugins</span>: [</div><div class="line">            ...entryHtmlList,</div><div class="line">            <span class="comment">// 抽离css</span></div><div class="line">            <span class="keyword">new</span> ExtractTextPlugin(&#123;</div><div class="line">                <span class="attr">filename</span>: <span class="string">'static/css/[name].[chunkhash].css'</span>,</div><div class="line">                <span class="attr">allChunks</span>: <span class="literal">true</span></div><div class="line">            &#125;),</div><div class="line">            <span class="comment">// 抽离公共代码</span></div><div class="line">            <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">                <span class="attr">names</span>: [<span class="string">'vendor'</span>, <span class="string">'manifest'</span>]</div><div class="line">            &#125;),</div><div class="line">            <span class="comment">// 定义全局常量</span></div><div class="line">            <span class="comment">// cli命令行使用process.env.NODE_ENV不如期望效果，使用不了，所以需要使用DefinePlugin插件定义，定义形式'"development"'或JSON.stringify('development')</span></div><div class="line">            <span class="keyword">new</span> webpack.DefinePlugin(&#123;</div><div class="line">                <span class="string">'process.env'</span>: &#123;</div><div class="line">                    <span class="attr">NODE_ENV</span>: options.dev ? <span class="built_in">JSON</span>.stringify(<span class="string">'development'</span>) : <span class="built_in">JSON</span>.stringify(<span class="string">'production'</span>)</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line"></div><div class="line">        ],</div><div class="line"></div><div class="line">        <span class="attr">resolve</span>: &#123;</div><div class="line">            <span class="comment">// require时省略的扩展名，不再需要强制转入一个空字符串，如：require('module') 不需要module.js</span></div><div class="line">            extensions: [<span class="string">'.js'</span>, <span class="string">'.json'</span>, <span class="string">'.vue'</span>, <span class="string">'.scss'</span>, <span class="string">'.css'</span>],</div><div class="line">            <span class="comment">// require路径简化</span></div><div class="line">            alias: &#123;</div><div class="line">                <span class="string">'~'</span>: resolve(__dirname, <span class="string">'src'</span>),</div><div class="line">                <span class="comment">// Vue 最早会打包生成三个文件，一个是 runtime only 的文件 vue.common.js，一个是 compiler only 的文件 compiler.js，一个是 runtime + compiler 的文件 vue.js。</span></div><div class="line">                <span class="comment">// vue.js = vue.common.js + compiler.js，默认package.json的main是指向vue.common.js，而template 属性的使用一定要用compiler.js，因此需要在alias改变vue指向</span></div><div class="line">                vue: <span class="string">'vue/dist/vue'</span></div><div class="line">            &#125;,</div><div class="line">            <span class="comment">// 指定import从哪个目录开始查找</span></div><div class="line">            modules: [</div><div class="line">                resolve(__dirname, <span class="string">'src'</span>),</div><div class="line">                <span class="string">'node_modules'</span></div><div class="line">            ]</div><div class="line">        &#125;,</div><div class="line">        <span class="comment">// 开启http服务，publicPath =&gt; 需要与Output保持一致 || proxy =&gt; 反向代理 || port =&gt; 端口号</span></div><div class="line">        devServer: config.devServer ? &#123;</div><div class="line">            <span class="attr">port</span>: config.devServer.port,</div><div class="line">            <span class="attr">proxy</span>: config.devServer.proxy,</div><div class="line">            <span class="attr">publicPath</span>: config.publicPath,</div><div class="line">            <span class="attr">stats</span>: &#123; <span class="attr">colors</span>: <span class="literal">true</span> &#125;</div><div class="line">        &#125; : <span class="literal">undefined</span>,</div><div class="line">        <span class="comment">// 屏蔽文件超过限制大小的warn</span></div><div class="line">        performance: &#123;</div><div class="line">            <span class="attr">hints</span>: options.dev ? <span class="literal">false</span> : <span class="string">'warning'</span></div><div class="line">        &#125;,</div><div class="line">        <span class="comment">// 生成devtool，保证在浏览器可以看到源代码，生产环境设为false</span></div><div class="line">        devtool: <span class="string">'inline-source-map'</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!options.dev) &#123;</div><div class="line">        webpackObj.devtool = <span class="literal">false</span></div><div class="line">        webpackObj.plugins = (webpackObj.plugins || []).concat([</div><div class="line">            <span class="comment">// 压缩js</span></div><div class="line">            <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</div><div class="line">                <span class="comment">// webpack2，默认为true，可以不用设置</span></div><div class="line">                compress: &#123;</div><div class="line">                    <span class="attr">warnings</span>: <span class="literal">false</span></div><div class="line">                &#125;</div><div class="line">            &#125;),</div><div class="line">            <span class="comment">//  压缩 loaders</span></div><div class="line">            <span class="keyword">new</span> webpack.LoaderOptionsPlugin(&#123;</div><div class="line">                <span class="attr">minimize</span>: <span class="literal">true</span></div><div class="line">            &#125;)</div><div class="line">        ])</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> webpackObj</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="上面的代码对于每个配置项都有注释说明，这里有几点需要注意的："><a href="#上面的代码对于每个配置项都有注释说明，这里有几点需要注意的：" class="headerlink" title="上面的代码对于每个配置项都有注释说明，这里有几点需要注意的："></a>上面的代码对于每个配置项都有注释说明，这里有几点需要注意的：</h2><h3 id="1-webpack-config-js导出的是一个function"><a href="#1-webpack-config-js导出的是一个function" class="headerlink" title="1. webpack.config.js导出的是一个function"></a>1. webpack.config.js导出的是一个function</h3><p>之前<a href="https://github.com/xiaobinwu/Wuji" target="_blank" rel="external">项目</a>的webpack.config.js是以对象形式export的，如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">module.exports = &#123;</div><div class="line">    entry: ...,</div><div class="line">    output: &#123;</div><div class="line">        ...</div><div class="line">    &#125;,</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>而现在倒出来的是一个function，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">module.exports = (options = &#123;&#125;) =&gt; &#123;</div><div class="line">    return &#123;</div><div class="line">        entry: ...,</div><div class="line">        output: &#123;</div><div class="line">            ...</div><div class="line">        &#125;,</div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样的话，function会在执行webpack CLI的时候获取webpack的参数，通过options传进function，看一下package.json：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&quot;local&quot;: &quot;npm run dev --config=local&quot;,</div><div class="line">&quot;dev&quot;: &quot;webpack-dev-server -d --hot --inline --env.dev --env.config dev&quot;,</div><div class="line">&quot;build&quot;: &quot;rimraf dist &amp;&amp; webpack -p --env.config prod&quot; //rimraf清空dist目录</div></pre></td></tr></table></figure></p>
<p>对于<code>local</code>命令，我们执行的是<code>dev</code>命令，但是在最后面会<code>--config=local</code>，这是配置，这样我们可以通过<code>process.env.npm_config_config</code>获取到，而对于<code>dev</code>命令，对于<code>--env XXX</code>，我们便可以在function获取<code>option.config</code>= ‘dev’ 和 <code>option.dev</code>= true的值，特别方便！以此便可以同步参数来加载不同的配置文件了。对于<code>-d</code>、<code>-p</code>不清楚的话，可以<a href="https://doc.webpack-china.org/api/cli/" target="_blank" rel="external">这里</a>查看,很详细！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 配置文件，根据 run script不同的config参数来调用不同config</div><div class="line">const config = require(&apos;./config/&apos; + (process.env.npm_config_config || options.config || &apos;dev&apos;))</div></pre></td></tr></table></figure></p>
<h3 id="2-modules放置模板文件、入口文件、对应模块的vue文件"><a href="#2-modules放置模板文件、入口文件、对应模块的vue文件" class="headerlink" title="2. modules放置模板文件、入口文件、对应模块的vue文件"></a>2. modules放置模板文件、入口文件、对应模块的vue文件</h3><p>将入口文件和模板文件放到modules目录（名字保持一致），webpack文件会通过glob读取modules目录，遍历生成入口文件对象和模板文件数组，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">const entries = glob.sync(&apos;./src/modules/*.js&apos;)</div><div class="line">const entryJsList = &#123;&#125;</div><div class="line">const entryHtmlList = []</div><div class="line">for (const path of entries) &#123;</div><div class="line">    const chunkName = path.slice(&apos;./src/modules/&apos;.length, -&apos;.js&apos;.length)</div><div class="line">    entryJsList[chunkName] = path</div><div class="line">    entryHtmlList.push(new HtmlWebpackPlugin(&#123;</div><div class="line">        template: path.replace(&apos;.js&apos;, &apos;.html&apos;),</div><div class="line">        filename: &apos;modules/&apos; + chunkName + &apos;.html&apos;,</div><div class="line">        chunks: [&apos;manifest&apos;, &apos;vendor&apos;, chunkName]</div><div class="line">    &#125;))</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对于HtmlWebpackPlugin插件中几个配置项的意思是，template：模板路径，filename：文件名称，这里为了区分开来模板文件我是放置在dist/modules文件夹中，而对应的编译打包好的js、img（对于图片我们是使用file-loader、url-loader进行抽离，对于这两个不是很理解的，可以看<a href="https://vue-loader.vuejs.org/zh-cn/configurations/asset-url.html" target="_blank" rel="external">这里</a>）、css我也是会放在dist/下对应目录的，这样目录会比较清晰。chunks：指定插入文件中的chunk,后面我们会生成manifest文件、公共vendor、以及对应生成的js\css（名称一样）</p>
<h3 id="3-处理开发环境和生产环境ExtractTextPlugin的使用情况"><a href="#3-处理开发环境和生产环境ExtractTextPlugin的使用情况" class="headerlink" title="3. 处理开发环境和生产环境ExtractTextPlugin的使用情况"></a>3. 处理开发环境和生产环境ExtractTextPlugin的使用情况</h3><p>开发环境，不需要把css进行抽离，要以style插入html文件中，可以很好实现热替换<br>生产环境，需要把css进行抽离合并，如下（根据options.dev区分开发和生产）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">// 处理开发环境和生产环境ExtractTextPlugin的使用情况</div><div class="line">function cssLoaders(loader, opt) &#123;</div><div class="line">    const loaders = loader.split(&apos;!&apos;)</div><div class="line">    const opts = opt || &#123;&#125;</div><div class="line">    if (options.dev) &#123;</div><div class="line">        if (opts.extract) &#123;</div><div class="line">            return loader</div><div class="line">        &#125; else &#123;</div><div class="line">            return loaders</div><div class="line">        &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">        const fallbackLoader = loaders.shift()</div><div class="line">        return ExtractTextPlugin.extract(&#123;</div><div class="line">            use: loaders,</div><div class="line">            fallback: fallbackLoader</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">...</div><div class="line">// 使用情况</div><div class="line">// 注意：需要安装vue-template-compiler，不然编译会报错</div><div class="line">&#123;</div><div class="line">    test: /\.vue$/,</div><div class="line">    loader: &apos;vue-loader&apos;,</div><div class="line">    options: &#123;</div><div class="line">        loaders: &#123;</div><div class="line">            sass: cssLoaders(&apos;vue-style-loader!css-loader!sass-loader&apos;, &#123; extract: true &#125;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;,</div><div class="line">...</div><div class="line">&#123;</div><div class="line">    test: /\.(scss|sass)$/,</div><div class="line">    use: cssLoaders(&apos;style-loader!css-loader!sass-loader&apos;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>再使用ExtractTextPlugin合并抽离到<code>static/css/</code>目录</p>
<h3 id="4-定义全局常量"><a href="#4-定义全局常量" class="headerlink" title="4. 定义全局常量"></a>4. 定义全局常量</h3><p>cli命令行（<code>webpack -p</code>）使用process.env.NODE_ENV不如期望效果，使用不了，所以需要使用DefinePlugin插件定义，定义形式’”development”‘或JSON.stringify(process.env.NODE_ENV)，我使用这样的写法’development’，结果报错（针对webpack2），查找了一下网上资料，<a href="https://github.com/webpack/webpack/issues/2537" target="_blank" rel="external">它</a>是这样讲的，可以去看一下，设置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">new webpack.DefinePlugin(&#123;</div><div class="line">    &apos;process.env&apos;: &#123;</div><div class="line">        NODE_ENV: options.dev ? JSON.stringify(&apos;development&apos;) : JSON.stringify(&apos;production&apos;)</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="5-使用eslint修正代码规范"><a href="#5-使用eslint修正代码规范" class="headerlink" title="5. 使用eslint修正代码规范"></a>5. 使用eslint修正代码规范</h3><p>通过eslint来检查代码的规范性，通过定义一套配置项，来规范代码，这样多人协作，写出来的代码也会比较优雅，不好的地方是，就是配置项太多，有些默认项设置我们不需要，但是确是处处限制我们，需要通过配置屏蔽掉，可以通过<code>.eslintrc</code>文件或是package.json的<code>eslintConfig</code>，还有其他方式，可以到<a href="http://eslint.cn/" target="_blank" rel="external">中文网</a>看，这里我用的是package.json方式，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">  ...</div><div class="line">&quot;eslintConfig&quot;: &#123;</div><div class="line">  &quot;parser&quot;: &quot;babel-eslint&quot;,</div><div class="line">  &quot;extends&quot;: &quot;enough&quot;,</div><div class="line">  &quot;env&quot;: &#123;</div><div class="line">    &quot;browser&quot;: true,</div><div class="line">    &quot;node&quot;: true,</div><div class="line">    &quot;commonjs&quot;: true,</div><div class="line">    &quot;es6&quot;: true</div><div class="line">  &#125;,</div><div class="line">  &quot;rules&quot;: &#123;</div><div class="line">    &quot;linebreak-style&quot;: 0,</div><div class="line">    &quot;indent&quot;: [2, 4],</div><div class="line">    &quot;no-unused-vars&quot;: 0,</div><div class="line">    &quot;no-console&quot;: 0</div><div class="line">  &#125;,</div><div class="line">  &quot;plugins&quot;: [</div><div class="line">    &quot;html&quot;</div><div class="line">  ]</div><div class="line">&#125;,</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>我们还需要安装 <code>npm install eslint eslint-config-enough eslint-loader --save-dev</code>，eslint-config-enough是所谓的配置文件，这样package.json的内容才能起效，但是不当当是这样，对应编辑器也需要安装对应的插件，sublime text 3需要安装SublimeLinter、SublimeLinter-contrib-eslint插件。对于所有规则的详解，可以去看<a href="http://eslint.cn/docs/user-guide/configuring" target="_blank" rel="external">官网</a>，也可以去<a href="http://blog.guowenfh.com/2016/08/07/ESLint-Rules/" target="_blank" rel="external">这里</a>看，很详细！<br>由于我们使用的是vue-loader，自然我们是希望能对.vue文件eslint，那么需要安装eslint-plugin-html，在package.json中进行配置。然后对应webpack配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    enforce: &apos;pre&apos;,</div><div class="line">    test: /.vue$/,</div><div class="line">    loader: &apos;eslint-loader&apos;,</div><div class="line">    exclude: /node_modules/</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们会发现webpack v1和v2之间会有一些不同，比如webpack1对于预先加载器处理的执行是这样的，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">module: &#123;</div><div class="line">  preLoaders: [</div><div class="line">    &#123;</div><div class="line">      test: /\.js$/,</div><div class="line">      loader: &quot;eslint-loader&quot;</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>更多的不同可以到<a href="https://doc.webpack-china.org/guides/migrating/" target="_blank" rel="external">中文网</a>看,很详细，不做拓展。</p>
<h3 id="6-alias-vue指向问题"><a href="#6-alias-vue指向问题" class="headerlink" title="6. alias vue指向问题"></a>6. alias vue指向问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">alias: &#123;</div><div class="line">    vue: &apos;vue/dist/vue&apos;</div><div class="line">&#125;,</div><div class="line">...</div></pre></td></tr></table></figure>
<p>Vue 最早会打包生成三个文件，一个是 runtime only 的文件 vue.common.js，一个是 compiler only 的文件 compiler.js，一个是 runtime + compiler 的文件 vue.js。<br>vue.js = vue.common.js + compiler.js，默认package.json的main是指向vue.common.js，而template 属性的使用一定要用compiler.js，因此需要在alias改变vue指向</p>
<h3 id="7-devServer的使用"><a href="#7-devServer的使用" class="headerlink" title="7. devServer的使用"></a>7. devServer的使用</h3><p>之前的<a href="https://github.com/xiaobinwu/Wuji" target="_blank" rel="external">项目</a>中使用的是用express启动http服务，webpack-dev-middleware＋webpack-hot-middleware，这里会用到compiler＋compilation，这个是webpack的编译器和编译过程的一些知识，也不是很懂，后续要去做做功课，应该可以加深对webpack运行机制的理解。这样做的话，感觉复杂很多，对于webpack2.0 devServer似乎功能更强大更加完善了，所以直接使用就可以了。如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">devServer: &#123;</div><div class="line">    port: 8080, //端口号</div><div class="line">    proxy: &#123; //方向代理 /api/auth/ ＝&gt; http://api.example.dev</div><div class="line">        &apos;/api/auth/&apos;: &#123;</div><div class="line">            target: &apos;http://api.example.dev&apos;,</div><div class="line">            changeOrigin: true,</div><div class="line">            pathRewrite: &#123; &apos;^/api&apos;: &apos;&apos; &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    publicPath: config.publicPath,</div><div class="line">    stats: &#123; colors: true &#125;</div><div class="line">&#125;</div><div class="line">//changeOrigin会修改HTTP请求头中的Host为target的域名， 这里会被改为api.example.dev</div><div class="line">//pathRewrite用来改写URL， 这里我们把/api前缀去掉，直接使用/auth/请求</div></pre></td></tr></table></figure></p>
<p><a href="https://github.com/fenivana/webpack-in-action" target="_blank" rel="external">webpack 2 打包实战</a>讲解得非常好，非常棒。可以去看一下，一定会有所收获！</p>
<h3 id="8-热重载原理"><a href="#8-热重载原理" class="headerlink" title="8. 热重载原理"></a>8. 热重载原理</h3><p><a href="https://doc.webpack-china.org/concepts/hot-module-replacement/" target="_blank" rel="external">webpack中文网</a>,讲的还算清楚，不过可能太笨，看起来还是云里雾里的，似懂非懂的，补补课，好好看看。</p>
<h3 id="9-localtunnel的使用"><a href="#9-localtunnel的使用" class="headerlink" title="9. localtunnel的使用"></a>9. localtunnel的使用</h3><p>Localtunnel 是一个可以让内网服务器暴露到公网上的开源项目，使用可以看<a href="https://scarletsky.github.io/2016/01/17/localtunnel-usage/" target="_blank" rel="external">这里</a>，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ npm install -g localtunnel</div><div class="line">$ lt --port 8080</div><div class="line">your url is: https://uhhzexcifv.localtunnel.me</div></pre></td></tr></table></figure></p>
<p>这样的话，可以把我们的本地网站暂时性地暴露到公网，可以对网站做一些线上线下对比，详细内容可以去了解一下localtunnel，这里讲的是通过上面配置，访问<code>https://uhhzexcifv.localtunnel.me</code>，没有达到理想效果，出现了<code>Invalid Host header</code>的错误,因为devServer缺少一个配置<code>disableHostCheck: true</code>,这样的一个配置，很多文档上面都没有说明，字面上面的意思<code>不要去检查Host</code>，这样设置，便可以绕过这一层检验，设置的配置项在<a href="https://github.com/webpack/webpack-dev-server/blob/master/lib/optionsSchema.json" target="_blank" rel="external">optionsSchema.json</a>中，issue可以看<a href="https://github.com/webpack/webpack-dev-server/issues/883" target="_blank" rel="external">这里</a></p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a><span class="tag-list-count">1</span></li></ul></div><div class="categories"><i class="icon icon-category"></i><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a><span class="category-list-count">4</span></li></ul></div></div><div class="article-comment" style="max-width:800px"><div class="ds-thread" id="ds-thread" data-thread-key="cj7ju58pj000j34p2ymmrxv8q" data-title="简单vue项目脚手架" data-url="http://yoursite.com/2017/06/08/my-vue-scaffold/" site-name="ueibo"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2017/04/21/Wuji/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2017/08/25/electron-vue-project/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/xiaobinwu" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="http://weibo.com/u/2379094031" title="Weibo" target="_blank"><i class="icon icon-weibo"></i></a></li><li><a href="Mailto:739288994@qq.com" title="Email" target="_blank"><i class="icon icon-email"></i></a></li></ul><div class="site"><span>本站总访问量</span><span id="busuanzi_value_site_pv"></span><span>次，访客数</span><span id="busuanzi_value_site_uv"></span><span>人次</span></div></div><div class="bottom"><p class="copyright">© 2017 前端穷屌丝，爱码人士<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small></p></div></div><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>